
<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN"
  "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">

<html xmlns="http://www.w3.org/1999/xhtml">
  <head>
    <meta http-equiv="X-UA-Compatible" content="IE=Edge" />
    <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
    <title>First App &#8212; Babble 0 documentation</title>
    <link rel="stylesheet" href="../_static/alabaster.css" type="text/css" />
    <link rel="stylesheet" href="../_static/pygments.css" type="text/css" />
    <script type="text/javascript" id="documentation_options" data-url_root="../" src="../_static/documentation_options.js"></script>
    <script type="text/javascript" src="../_static/jquery.js"></script>
    <script type="text/javascript" src="../_static/underscore.js"></script>
    <script type="text/javascript" src="../_static/doctools.js"></script>
    <script type="text/javascript" src="../_static/language_data.js"></script>
    <link rel="index" title="Index" href="../genindex.html" />
    <link rel="search" title="Search" href="../search.html" />
   
  <link rel="stylesheet" href="../_static/custom.css" type="text/css" />
  
  
  <meta name="viewport" content="width=device-width, initial-scale=0.9, maximum-scale=0.9" />

  </head><body>
  <div class="document">
    
      <div class="sphinxsidebar" role="navigation" aria-label="main navigation">
        <div class="sphinxsidebarwrapper">
<p class="logo">
  <a href="../index.html">
    <img class="logo" src="../_static/babblelogo2.png" alt="Logo"/>
    
    <h1 class="logo logo-name">Babble</h1>
    
  </a>
</p>






<p>
<iframe src="https://ghbtns.com/github-btn.html?user=mosaicnetworks&repo=babble&type=watch&count=true&size=large&v=2"
  allowtransparency="true" frameborder="0" scrolling="0" width="200px" height="35px"></iframe>
</p>





<h3>Navigation</h3>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../index.html">Welcome to Babble Android</a></li>
</ul>

<div class="relations">
<h3>Related Topics</h3>
<ul>
  <li><a href="../index.html">Documentation overview</a><ul>
  </ul></li>
</ul>
</div>
<div id="searchbox" style="display: none" role="search">
  <h3>Quick search</h3>
    <div class="searchformwrapper">
    <form class="search" action="../search.html" method="get">
      <input type="text" name="q" />
      <input type="submit" value="Go" />
      <input type="hidden" name="check_keywords" value="yes" />
      <input type="hidden" name="area" value="default" />
    </form>
    </div>
</div>
<script type="text/javascript">$('#searchbox').show(0);</script>








        </div>
      </div>
      <div class="documentwrapper">
        <div class="bodywrapper">
          

          <div class="body" role="main">
            
  <div class="section" id="first-app">
<span id="firstapp"></span><h1>First App<a class="headerlink" href="#first-app" title="Permalink to this headline">¶</a></h1>
<div class="section" id="prerequisites">
<h2>Prerequisites<a class="headerlink" href="#prerequisites" title="Permalink to this headline">¶</a></h2>
<p>We will assume that you have installed Android Studio, an Android SDK with API
version 29 and Android NDK. If you use a previous API version, the <code class="docutils literal notranslate"><span class="pre">create</span>
<span class="pre">activity</span></code> items in these instructions will use AppCompat instead of
AndroidX[#androidx]_, leading to incompatibilities with the pasted source code.
The babble node itself is compatible with AppCompat, but converting the sample
to use AppCompat is beyond the scope of this article.</p>
<p>This tutorial is going to assume deployment to a physical Android device. Thus
you will need an Android device (minimum API version 19[#androiddevice]) with
the developer options turned on, debugging enabled, and a suitable USB cable.
You could use the android emulator, but that is beyond the scope of this
article.</p>
<p>[#androidx]: You can read more about AndroidX here: [<a class="reference external" href="https://android-developers.googleblog.com/2018/05/hello-world-androidx.html](https://android-developers.googleblog.com/2018/05/hello-world-androidx.html">https://android-developers.googleblog.com/2018/05/hello-world-androidx.html](https://android-developers.googleblog.com/2018/05/hello-world-androidx.html</a>)</p>
<p>[#androiddevice]: API version 19 is Android 4.4 (KitKat). In May 3.8% of devices
were using version 18 or lower. Android 4.4 was released in 2013. Whilst it
would be possible to code support for earlier versions, the existing code uses
Android features introduced in Android 4.4.</p>
</div>
<div class="section" id="our-first-minimal-app">
<h2>Our First Minimal App<a class="headerlink" href="#our-first-minimal-app" title="Permalink to this headline">¶</a></h2>
<p>First up we will create a minimal app to test our environment and prove that we
have loaded the <code class="docutils literal notranslate"><span class="pre">babble-android</span></code> library correctly. Fire up Android Studio and
select <code class="docutils literal notranslate"><span class="pre">File/New</span> <span class="pre">Project</span></code>. You are asked to choose a project template.</p>
<p>Choose <strong>Empty Activity</strong> from the <strong>Phone and Tablet</strong> tab, and click <strong>Next</strong>.</p>
<p>The options here should be self-explanatory. We would recommend not using spaces
in the Package Name or the Save Location. Do not set the Minimum API Level below
19. Click <strong>Finish</strong>.</p>
<p>Android Studio will open, and after expanding some of the menus it will look
something like above.</p>
<div class="section" id="running-the-app">
<h3>Running the App<a class="headerlink" href="#running-the-app" title="Permalink to this headline">¶</a></h3>
<p>Connect your android device to your computer via a USB cable. First we will test
that the Android Debug Bridge (<strong>adb</strong>) can see the device.</p>
<p>The command <code class="docutils literal notranslate"><span class="pre">adb</span> <span class="pre">kill-server</span></code> will reset this connection.</p>
<p>If you can see a device listed, go back to Android Studio. and in the top right
is a target device dropdown. Select your device from the list.</p>
<p>If you cannot find your device in the list, the
<code class="docutils literal notranslate"><span class="pre">Troubleshoot</span> <span class="pre">device</span> <span class="pre">connections</span></code> option on that menu should help.</p>
<p>Then press that little green triangle to the right of the dropdown device menu.
Gradle then builds the app, which is then installed onto the physical android
device that you selected. The whole process took about 20 seconds on my laptop
(feel free to buy me a quicker one).</p>
<p>If you look on the device, you should find the app installed, as on the right
above.</p>
<p>Congratulations, you have an app. Now onto Babble…</p>
</div>
</div>
<div class="section" id="our-first-babble-app">
<h2>Our First Babble App<a class="headerlink" href="#our-first-babble-app" title="Permalink to this headline">¶</a></h2>
<p>We will now integrate the <code class="docutils literal notranslate"><span class="pre">babble-android</span></code> library into our skeleton app. We
will use it to generate a key pair – just to prove that we have a working
library instance.</p>
<div class="section" id="integrating-the-babble-android-library">
<h3>Integrating the Babble-Android Library<a class="headerlink" href="#integrating-the-babble-android-library" title="Permalink to this headline">¶</a></h3>
<p>The library is hosted in <strong>jcenter</strong>. To make it available, we need to amend
some gradle scripts.</p>
<p>In Android Studio, double click on the Project <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> as highlighted
in the screenshot above.</p>
<p>We then add the 3 line <code class="docutils literal notranslate"><span class="pre">maven</span></code> instruction as below:</p>
<p>Which leaves the entire file looking like this:</p>
<p>Next we need to amend the app <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> (it is below the Project
<code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> in the screenshot above. We add an implementation line to the
bottom dependencies section.</p>
<p><code class="docutils literal notranslate"><span class="pre">`gradle</span>
<span class="pre">implementation</span> <span class="pre">'io.mosaicnetworks:babble:0.1.0'</span>
<span class="pre">`</span></code></p>
<p>This leaves us with this full file:</p>
</div>
<div class="section" id="using-the-library">
<h3>Using the Library<a class="headerlink" href="#using-the-library" title="Permalink to this headline">¶</a></h3>
<p>The library should now be included in the project. So lets use it! Open
<code class="docutils literal notranslate"><span class="pre">MainActivity.java</span></code> as below:</p>
<p>Add the lines below underneath the last import statement. The lines will appear
greyed out, as the import is not yet used. As well as babble we are importing
the <code class="docutils literal notranslate"><span class="pre">Log</span></code> package to write to the Android logs.</p>
<p>Add the following lines as the last line of the <code class="docutils literal notranslate"><span class="pre">onCreate</span></code> function</p>
<dl class="docutils">
<dt>..code:</dt>
<dd>KeyPair kp = new KeyPair();
Log.i(“Yippee”,kp.privateKey);</dd>
</dl>
<p>This code generates a key pair and writes the private code to the logs.</p>
<p>Save all the files and run your app.</p>
<p>The app looks exactly as per the previous iteration, so lets take a look under
the hood. Press logcat, as highlighted in gray in the screenshot above. Then
type <code class="docutils literal notranslate"><span class="pre">yippee</span></code> in the search box at the top of that window to filter the logs.
You should have a freshly generated private key in there.</p>
<p>This project at this stage is available from github from [here](<a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage1">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage1</a>) [#stage1]</p>
<p>[#stage1]: This code is the stage1 branch at <a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage1">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage1</a></p>
<p>The downloadable version of the project has <em>Mosaic Networks</em> icons, rather than
the default Android ones. You can customise the icons using
[Android Studio Image Asset Studio](<a class="reference external" href="https://developer.android.com/studio/write/image-asset-studio">https://developer.android.com/studio/write/image-asset-studio</a>).[#imageasset]</p>
<p>[#imageasset]: [Android Studio Image Asset Studio](<a class="reference external" href="https://developer.android.com/studio/write/image-asset-studio">https://developer.android.com/studio/write/image-asset-studio</a>) is described here: <a class="reference external" href="https://developer.android.com/studio/write/image-asset-studio">https://developer.android.com/studio/write/image-asset-studio</a></p>
</div>
</div>
<div class="section" id="our-first-babble-blockchain">
<h2>Our First Babble Blockchain<a class="headerlink" href="#our-first-babble-blockchain" title="Permalink to this headline">¶</a></h2>
<p>Now we have access to the babble library from within our app, the next stage is
to start a babble network. We will start with a single node. But before we can
start babble we need to add some UI elements to allow us to interact with our
babble node.</p>
<p>Currently our application launches the activity <code class="docutils literal notranslate"><span class="pre">MainActivity</span></code> which calls the
key pair generation code in it’s <code class="docutils literal notranslate"><span class="pre">onCreate</span></code> method.</p>
<p>In the Sample App [#sampleapp] that we are working towards, the MainActivity
Screen presents the user with a choice of “<strong>New</strong>” or “<strong>Join</strong>”. <strong>New</strong>
starts a new babble network with your device as the sole peer. <strong>Join</strong> lets you
specify the address of an existing network, pull down the configuration for that
network and request to join it.</p>
<p>As <strong>New</strong> is standalone functionality, and <strong>Join</strong> requires <strong>New</strong> be
implemented to function, we will implement <strong>New</strong> first.</p>
<p>[#sampleapp]: The sample app is part of the <code class="docutils literal notranslate"><span class="pre">babble-android</span></code> library and is
available from the [GitHub repo](<a class="reference external" href="https://github.com/mosaicnetworks/babble-android">https://github.com/mosaicnetworks/babble-android</a>)</p>
<div class="section" id="main-activity">
<h3>Main Activity<a class="headerlink" href="#main-activity" title="Permalink to this headline">¶</a></h3>
<p>First up we will amend <code class="docutils literal notranslate"><span class="pre">MainActivity.java</span></code>. replace all of the code with the
following:</p>
<p>We have removed our key generation in the onCreate method. Instead
<code class="docutils literal notranslate"><span class="pre">MainActivity</span></code> now extends <code class="docutils literal notranslate"><span class="pre">BaseConfigActivity</span></code>. The <code class="docutils literal notranslate"><span class="pre">BaseConfigActivity</span></code>
provides screens to create <strong>New</strong> and to <strong>Join</strong> networks. We just need to
define the callback event handlers for each case. The further processing is
identical in both cases - both result in your babble node being started and
in a babble network – the only difference is the number of nodes.</p>
<p>If you want more control over the network joining screens, the branches with
0.2.1 suffices in the github repo have a worked version using activities
external to the <code class="docutils literal notranslate"><span class="pre">babble-android</span></code> library.</p>
<p>Add the line below as the first line of the class, we will use this later to
identify log messages from our app. :</p>
</div>
<div class="section" id="appstate-java">
<h3>AppState.java<a class="headerlink" href="#appstate-java" title="Permalink to this headline">¶</a></h3>
<p>Copy the source below into place in the same folder as <code class="docutils literal notranslate"><span class="pre">MainActivity.java</span></code>:</p>
</div>
<div class="section" id="babbletx-java">
<h3>BabbleTx.java<a class="headerlink" href="#babbletx-java" title="Permalink to this headline">¶</a></h3>
<p>Copy the source below into place in the same folder as <code class="docutils literal notranslate"><span class="pre">MainActivity.java</span></code>:</p>
</div>
<div class="section" id="message-java">
<h3>Message.java<a class="headerlink" href="#message-java" title="Permalink to this headline">¶</a></h3>
<p>Copy the source below into place in the same folder as <code class="docutils literal notranslate"><span class="pre">MainActivity.java</span></code>:</p>
<p>You will note the section below introduces an external dependency:</p>
<p>Add the lines below to the app <code class="docutils literal notranslate"><span class="pre">build.gradle</span></code> file dependencies section, and
click <strong>Sync Now</strong> on the pop up bar:</p>
</div>
<div class="section" id="messagingservice-java">
<h3>MessagingService.java<a class="headerlink" href="#messagingservice-java" title="Permalink to this headline">¶</a></h3>
<p>Copy the source below into place in the same folder as <code class="docutils literal notranslate"><span class="pre">MainActivity.java</span></code>:</p>
</div>
<div class="section" id="chat-activity">
<h3>Chat Activity<a class="headerlink" href="#chat-activity" title="Permalink to this headline">¶</a></h3>
<p>Create a new empty activity, <code class="docutils literal notranslate"><span class="pre">ChatActivity</span></code>. We will not add any functionality
to it at this point, we just need it to exist as it is referenced in
<code class="docutils literal notranslate"><span class="pre">MainActivity</span></code>.</p>
</div>
<div class="section" id="running-babble">
<h3>Running Babble<a class="headerlink" href="#running-babble" title="Permalink to this headline">¶</a></h3>
<p>And finally after all of that cut and paste, we have a working instance of
babble — albeit with at least one major drawback — it has no UI and no way
to access it.</p>
<p>If you start the app through Android Studio, and look at the logcat output
(filtered to just our app), after pressing the New button, entering a Moniker
and pressing the Join button, you should see something like below:</p>
<p>The lines of red text are the lines of interest, stripping out the date and
other prefixes gives something like:</p>
<p>The key item is the “<strong>state=Babbling</strong>” line, which denotes that Babble is up
and running.</p>
</div>
</div>
<div class="section" id="some-explanations">
<h2>Some Explanations<a class="headerlink" href="#some-explanations" title="Permalink to this headline">¶</a></h2>
<p>We have just added a lot of code, which is all co-dependent. Now we have a
babble invocation in place, we can pause to explain what just happened there.</p>
<p>The configuration of a babble node is handled by the <code class="docutils literal notranslate"><span class="pre">BaseConfigActivity</span></code>
class from whom <code class="docutils literal notranslate"><span class="pre">MainActivity</span></code> inherits. We just need to wire in the
<code class="docutils literal notranslate"><span class="pre">ChatActivity</span></code> to take over once we have a Babble network.</p>
<p>We define a MessagingService using the <code class="docutils literal notranslate"><span class="pre">getBabbleService()</span></code> function. This
boilerplate class wraps BabbleService from the babble-android library.</p>
<p>This project at this stage is available from github from [here](<a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage2">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage2</a>) [#stage2]</p>
<p>[#stage2]: This code is the stage2 branch at <a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage2">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage2</a></p>
</div>
<div class="section" id="interacting-with-babble">
<h2>Interacting with Babble<a class="headerlink" href="#interacting-with-babble" title="Permalink to this headline">¶</a></h2>
<p>The next stage is to make Babble usable. To do that we need to work on the
<code class="docutils literal notranslate"><span class="pre">ChatActivity</span></code> so it sends and receives messages from Babble.</p>
<p>First up we need a UI. We are going to use
[ChatKit](<a class="reference external" href="https://github.com/stfalcon-studio/ChatKit">https://github.com/stfalcon-studio/ChatKit</a>) rather than reinvent the
wheel.</p>
<div class="section" id="activity-chat-xml">
<h3>activity_chat.xml<a class="headerlink" href="#activity-chat-xml" title="Permalink to this headline">¶</a></h3>
<p>We can then add the layout to <code class="docutils literal notranslate"><span class="pre">res/layout/activity_chat.xml</span></code>
— replace all the contents with the code below:</p>
<p>The layout here is a fairly standard chat layout a message entry section at the
bottom of the screen and a message display above it.</p>
</div>
<div class="section" id="colors-xml">
<h3>colors.xml<a class="headerlink" href="#colors-xml" title="Permalink to this headline">¶</a></h3>
<p>We need to the add the following to <code class="docutils literal notranslate"><span class="pre">res/values/colors.xml</span></code> as it is used in
the code changes above.</p>
</div>
<div class="section" id="chatactivity-java">
<h3>ChatActivity.java<a class="headerlink" href="#chatactivity-java" title="Permalink to this headline">¶</a></h3>
<p>Replace all of the file <code class="docutils literal notranslate"><span class="pre">ChatActivity.java</span></code> with the code below:</p>
</div>
<div class="section" id="strings-xml">
<h3>strings.xml<a class="headerlink" href="#strings-xml" title="Permalink to this headline">¶</a></h3>
<p>We need to the add the following to <code class="docutils literal notranslate"><span class="pre">res/values/strings.xml</span></code> as they are used
in the code changes above.</p>
</div>
<div class="section" id="build-run-and-test">
<h3>Build, Run and Test<a class="headerlink" href="#build-run-and-test" title="Permalink to this headline">¶</a></h3>
<p>Build your app and run it. You should now be able to start a chat with yourself
and send messages to yourself as below:</p>
<p>This project at this stage is available from github from [here](<a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage3">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage3</a>) [#stage3]</p>
<p>[#stage3]: This code is the stage3 branch at <a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage3">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage3</a></p>
</div>
</div>
<div class="section" id="joining">
<h2>Joining<a class="headerlink" href="#joining" title="Permalink to this headline">¶</a></h2>
<p>Thus far, we have been dealing with a single node, which kind of misses the
whole point of having a blockchain. So this section remedies this. We will add a
new button the MainActivity to Join an existing blockchain. This will require
discovering the network - we will just enter an IP address for the moment -
although more complex schemes would be used in a production environment.</p>
<p>In the previous version (0.2.1) of Babble-Android, the explanation for joining
was over 400 lines of markdown text (plus screenshots). As of 0.2.2, it is just
to add 3 lines of code (shown in context below) to <code class="docutils literal notranslate"><span class="pre">MainActivity.java</span></code></p>
<div class="section" id="id1">
<h3>Build, Run and Test<a class="headerlink" href="#id1" title="Permalink to this headline">¶</a></h3>
<p>Build your app and run it on 2 devices. You should now be able to start a chat
on one and join with the other:</p>
<p>This project at this stage is available from github from [here](<a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage4">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage4</a>) [#stage4]</p>
<p>[#stage4]: This code is the stage4 branch at <a class="reference external" href="https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage4">https://github.com/mosaicnetworks/babble-android-tutorial/tree/stage4</a></p>
</div>
</div>
</div>


          </div>
          
        </div>
      </div>
    <div class="clearer"></div>
  </div>
    <div class="footer">
      &copy;2017, Mosaic Networks.
      
      |
      <a href="../_sources/first_app/first_app.rst.txt"
          rel="nofollow">Page source</a>
    </div>

    

    
  </body>
</html>